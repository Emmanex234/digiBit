<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DigiBit Finance - Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6;
    }
    .gradient-bg {
      background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
    }
    .card-hover {
      transition: all 0.3s ease;
    }
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    .progress-ring__circle {
      transition: stroke-dashoffset 0.35s;
      transform: rotate(-90deg);
      transform-origin: 50% 50%;
    }
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="bg-gray-100">
  <!-- Dashboard Layout -->
  <div class="flex h-screen overflow-hidden">
    <!-- Sidebar -->
    <div class="hidden md:flex md:flex-shrink-0">
      <div class="flex flex-col w-64 gradient-bg text-white">
        <div class="flex items-center justify-center h-16 px-4 border-b border-blue-800">
          <div class="flex items-center">
            <img src="/OIP.jpg" alt="Logo" class="h-8 w-8 rounded-full mr-2">
            <span class="text-xl font-bold">DigiBit Finance</span>
          </div>
        </div>
        <div class="flex flex-col flex-grow px-4 py-4 overflow-y-auto">
          <nav class="flex-1 space-y-2">
            <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg bg-blue-700 text-white">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
              </svg>
              Dashboard
            </a>
            <a href="#" onclick="invest()" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-blue-200 hover:bg-blue-800 hover:text-white">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              Investments
            </a>
            <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-blue-200 hover:bg-blue-800 hover:text-white">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
              Transactions
            </a>
            <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-blue-200 hover:bg-blue-800 hover:text-white">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
              </svg>
              Security
            </a>
            <a href="#" id="profileP" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-blue-200 hover:bg-blue-800 hover:text-white">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              Profile
            </a>
          </nav>
        </div>
        <div class="p-4 border-t border-blue-800">
          <div class="flex items-center">
            <img id="sidebar-profile-img" class="w-10 h-10 rounded-full mr-3" src="https://randomuser.me/api/portraits/men/32.jpg" alt="User">
            <div>
              <p id="sidebar-profile-name" class="text-sm font-medium text-white">Loading...</p>
              <p id="sidebar-profile-email" class="text-xs text-blue-200">Loading...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="flex flex-col flex-1 overflow-hidden">
      <!-- Top Navigation -->
      <div class="flex items-center justify-between h-16 px-6 bg-white border-b border-gray-200">
        <div class="flex items-center md:hidden">
          <button id="mobile-nav-toggle"  class="text-gray-500 focus:outline-none">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        <!-- Mobile Nav (responsive) -->
        <div id="mobile-nav" class="fixed inset-y-0 left-0 w-64 bg-white shadow-lg z-40 transform -translate-x-full transition-transform duration-300 md:hidden">
          <div class="flex items-center justify-between h-16 px-4 border-b border-gray-200">
            <div class="flex items-center">
              <img src="/OIP.jpg" alt="Logo" class="h-8 w-8 rounded-full mr-2">
              <span class="text-xl font-bold text-blue-900">DigiBit Finance</span>
            </div>
            <button id="close-mobile-nav" class="text-gray-500 focus:outline-none">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
          <nav class="flex flex-col px-4 py-4 space-y-2">
            <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg bg-blue-700 text-white">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
              </svg>
              Dashboard
            </a>
            <a href="#" onclick="invest()" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-blue-700 hover:bg-blue-100">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              Investments
            </a>
            <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-blue-700 hover:bg-blue-100">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
              Transactions
            </a>
            <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-blue-700 hover:bg-blue-100">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
              </svg>
              Security
            </a>
            <a href="#" id="Profile_main" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-blue-700 hover:bg-blue-100">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              Profile
            </a>
          </nav>
            <div class="p-4 border-t border-gray-200 flex items-center">
            <img id="mobile-profile-img" class="w-10 h-10 rounded-full mr-3" src="https://randomuser.me/api/portraits/men/32.jpg" alt="User">
            <div>
              <p id="mobile-profile-name" class="text-sm font-medium text-gray-900">Loading...</p>
              <p id="mobile-profile-email" class="text-xs text-gray-500">Loading...</p>
            </div>
            </div>
        </div>
        <script>
          // Mobile nav open/close logic
          document.addEventListener('DOMContentLoaded', function () {
            const mobileNav = document.getElementById('mobile-nav');
            const mobileNavToggle = document.getElementById('mobile-nav-toggle');
            const closeMobileNav = document.getElementById('close-mobile-nav');
            function openNav() {
              mobileNav.classList.remove('-translate-x-full');
            }
            function closeNav() {
              mobileNav.classList.add('-translate-x-full');
            }
            if (mobileNavToggle) {
              mobileNavToggle.addEventListener('click', function (e) {
                e.stopPropagation();
                openNav();
              });
            }
            if (closeMobileNav) {
              closeMobileNav.addEventListener('click', function (e) {
                e.stopPropagation();
                closeNav();
              });
            }
            // Close nav when clicking outside
            document.addEventListener('click', function (e) {
              if (window.innerWidth < 768 && mobileNav && !mobileNav.contains(e.target) && !mobileNavToggle.contains(e.target)) {
                closeNav();
              }
            });
            // Sync profile info
            function syncMobileProfile() {
              const name = document.getElementById('sidebar-profile-name')?.textContent || 'User';
              const email = document.getElementById('sidebar-profile-email')?.textContent || '';
              const img = document.getElementById('sidebar-profile-img')?.src || '';
              document.getElementById('mobile-profile-name').textContent = name;
              document.getElementById('mobile-profile-email').textContent = email;
              document.getElementById('mobile-profile-img').src = img;
            }
            setTimeout(syncMobileProfile, 500);
          });
        </script>
         
        </div>
        <div class="flex items-center space-x-4">
          <button class="p-1 text-gray-400 rounded-full hover:text-gray-500 focus:outline-none">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
            </svg>
          </button>
          <div class="relative">
            <button id="profile-menu-button" class="flex items-center space-x-2 focus:outline-none">
              <img id="topnav-profile-img" class="w-8 h-8 rounded-full" src="https://randomuser.me/api/portraits/men/32.jpg" alt="User">
              <span id="topnav-profile-name" class="hidden md:inline text-sm font-medium text-gray-700">Loading...</span>
            </button>
            <!-- Profile dropdown -->
            <div id="profile-menu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-10">
              <a href="#" id="profile-menu-item" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Your Profile</a>
              <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Settings</a>
              <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" id="logout-btn">Sign out</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content Area -->
      <div class="flex-1 overflow-auto p-6 animate__animated animate__fadeIn">
        <!-- Welcome Banner -->
        <div class="gradient-bg text-white rounded-xl p-6 mb-6 shadow-lg animate__animated animate__fadeInDown">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <div>
              <h2 id="welcome-message" class="text-2xl font-bold mb-2">Welcome back, Loading...</h2>
              <p class="text-blue-100">Track your investments and grow your portfolio</p>
            </div>
            <button id="quick-deposit-btn" class="mt-4 md:mt-0 bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold py-2 px-6 rounded-lg transition duration-300 transform hover:scale-105">
              Quick Deposit
            </button>
          </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
          <!-- Balance Card -->
          <div class="bg-white rounded-xl shadow-md p-6 card-hover animate__animated animate__fadeInLeft">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-medium text-gray-700">Total Balance</h3>
              <div class="p-2 bg-blue-100 rounded-lg">
                <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
            </div>
            <div class="flex items-end">
              <p id="total-balance" class="text-3xl font-bold text-gray-900">$0.00</p>
              <span id="balance-change" class="ml-2 text-sm text-green-500 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                </svg>
                0%
              </span>
            </div>
            <p class="text-sm text-gray-500 mt-2">Compared to last month</p>
          </div>

          <!-- Active Investments Card -->
          <div class="bg-white rounded-xl shadow-md p-6 card-hover animate__animated animate__fadeInUp">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-medium text-gray-700">Active Investments</h3>
              <div class="p-2 bg-green-100 rounded-lg">
                <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
              </div>
            </div>
            <div class="flex items-end">
              <p id="active-investments" class="text-3xl font-bold text-gray-900">$0.00</p>
              <span id="investment-change" class="ml-2 text-sm text-green-500 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                </svg>
                0%
              </span>
            </div>
            <p id="active-plans-count" class="text-sm text-gray-500 mt-2">0 active plans</p>
          </div>

          <!-- KYC Verification Card -->
          <div class="bg-white rounded-xl shadow-md p-6 card-hover animate__animated animate__fadeInRight">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-medium text-gray-700">KYC Verification</h3>
              <div class="p-2 bg-purple-100 rounded-lg">
                <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                </svg>
              </div>
            </div>
            <div class="flex items-center">
              <div class="relative w-16 h-16 mr-4">
                <svg class="w-16 h-16" viewBox="0 0 36 36">
                  <circle cx="18" cy="18" r="16" fill="none" class="stroke-current text-gray-200" stroke-width="2"></circle>
                  <circle id="kyc-progress-ring" cx="18" cy="18" r="16" fill="none" class="stroke-current text-green-500" stroke-width="2" stroke-dasharray="100" stroke-dashoffset="100"></circle>
                </svg>
                <div class="absolute inset-0 flex items-center justify-center">
                  <span id="kyc-percent" class="text-sm font-bold text-gray-700">0%</span>
                </div>
              </div>
              <div>
                <p id="kyc-status" class="text-sm text-gray-600 mb-2">Verification not started</p>
                <button id="start-kyc-btn" class="text-sm bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded-lg transition">
                  Start Verification
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Two Column Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Transaction History -->
          <div class="bg-white rounded-xl shadow-md overflow-hidden animate__animated animate__fadeInLeft">
            <div class="p-6 border-b border-gray-200">
              <div class="flex items-center justify-between">
                <h3 class="text-lg font-medium text-gray-900">Recent Transactions</h3>
                <a href="#" class="text-sm text-blue-600 hover:text-blue-800">View All</a>
              </div>
            </div>
            <div class="divide-y divide-gray-200" id="transactions-list">
              <!-- Transactions will be loaded here dynamically -->
              <div class="p-6 text-center text-gray-500">
                Loading transactions...
              </div>
            </div>
          </div>
          
          <!-- Investment Plans -->
          <div class="bg-white rounded-xl shadow-md overflow-hidden animate__animated animate__fadeInRight">
            <div class="p-6 border-b border-gray-200">
              <div class="flex items-center justify-between">
                <h3 class="text-lg font-medium text-gray-900">Available Plans</h3>
                <a href="#" class="text-sm text-blue-600 hover:text-blue-800">View All</a>
              </div>
            </div>
            <div class="divide-y divide-gray-200" id="investment-plans">
              <!-- Plans will be loaded here dynamically -->
              <div class="p-6 text-center text-gray-500">
                Loading investment plans...
              </div>
            </div>
          </div>
        </div>

        <!-- Deposit Section -->
        <div class="mt-6 bg-white rounded-xl shadow-md overflow-hidden animate__animated animate__fadeInUp">
          <div class="p-6 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">Make a Deposit</h3>
          </div>
          <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <!-- Deposit Method 1 -->
              <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-500 transition cursor-pointer">
                <div class="flex items-center mb-3">
                  <div class="p-2 bg-blue-100 rounded-lg mr-3">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                    </svg>
                  </div>
                  <h4 class="font-medium text-gray-900">Credit Card</h4>
                </div>
                <p class="text-sm text-gray-500">Instant deposit with your credit or debit card</p>
              </div>
              
              <!-- Deposit Method 2 -->
              <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-500 transition cursor-pointer">
                <div class="flex items-center mb-3">
                  <div class="p-2 bg-green-100 rounded-lg mr-3">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                  </div>
                  <h4 class="font-medium text-gray-900">Bank Transfer</h4>
                </div>
                <p class="text-sm text-gray-500">Transfer from your bank account (1-2 business days)</p>
              </div>
              
              <!-- Deposit Method 3 -->
              <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-500 transition cursor-pointer">
                <div class="flex items-center mb-3">
                  <div class="p-2 bg-purple-100 rounded-lg mr-3">
                    <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                    </svg>
                  </div>
                  <h4 class="font-medium text-gray-900">Cryptocurrency</h4>
                </div>
                <p class="text-sm text-gray-500">Deposit using Bitcoin, Ethereum or other cryptocurrencies</p>
              </div>
            </div>
            
            <div class="mt-6">
              <button id="proceed-deposit-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition transform hover:scale-[1.01]">
                Proceed to Deposit
              </button>
            </div>

            <!-- Withdrawal Button -->
            <div class="mt-4">
              <button id="withdraw-btn" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-3 px-6 rounded-lg transition transform hover:scale-[1.01]">
                Withdraw Funds
              </button>
            </div>
            <script>
              // Withdrawal modal logic
              document.addEventListener('DOMContentLoaded', function () {
                const withdrawBtn = document.getElementById('withdraw-btn');
                if (withdrawBtn) {
                  withdrawBtn.addEventListener('click', openWithdrawModal);
                }
              });

              function openWithdrawModal() {
                const modalHtml = `
                  <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6 animate__animated animate__fadeInUp">
                      <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-900">Withdraw Funds</h3>
                        <button id="close-withdraw-modal" class="text-gray-500 hover:text-gray-700">✕</button>
                      </div>
                      <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Amount ($)</label>
                        <input id="withdraw-amount" type="number" min="10" max="${currentUserBalance.toFixed(2)}"
                          class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          placeholder="Enter amount (min $10)">
                      </div>
                      <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Withdrawal Method</label>
                        <select id="withdraw-method" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                          <option value="bank">Bank Transfer</option>
                          <option value="crypto">Cryptocurrency</option>
                        </select>
                      </div>
                      <div id="withdraw-details" class="mb-4">
                        <!-- Dynamic details will appear here -->
                      </div>
                      <div id="withdraw-error" class="text-red-600 mb-4 hidden"></div>
                      <div class="mt-6 flex justify-end space-x-3">
                        <button id="cancel-withdraw" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">
                          Cancel
                        </button>
                        <button id="confirm-withdraw" class="px-4 py-2 text-sm font-medium text-white bg-yellow-500 rounded-lg hover:bg-yellow-600">
                          Submit Withdrawal
                        </button>
                      </div>
                    </div>
                  </div>
                `;
                const modal = document.createElement('div');
                modal.innerHTML = modalHtml;
                document.body.appendChild(modal);

                // Dynamic details
                const withdrawMethod = modal.querySelector('#withdraw-method');
                const withdrawDetails = modal.querySelector('#withdraw-details');
                function updateDetails() {
                  if (withdrawMethod.value === 'crypto') {
                    withdrawDetails.innerHTML = `
                      <label class="block text-sm font-medium text-gray-700 mb-1">Crypto Address</label>
                      <input id="withdraw-crypto-address" type="text" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your wallet address">
                      <label class="block text-sm font-medium text-gray-700 mb-1 mt-3">Select Coin</label>
                      <select id="withdraw-crypto-type" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="bitcoin">Bitcoin (BTC)</option>
                        <option value="ethereum">Ethereum (ETH)</option>
                        <option value="usdt">Tether (USDT)</option>
                        <option value="bnb">BNB (BNB)</option>
                      </select>
                    `;
                  } else {
                    withdrawDetails.innerHTML = `
                      <label class="block text-sm font-medium text-gray-700 mb-1">Bank Account Number</label>
                      <input id="withdraw-bank-account" type="text" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your bank account number">
                      <label class="block text-sm font-medium text-gray-700 mb-1 mt-3">Bank Name</label>
                      <input id="withdraw-bank-name" type="text" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your bank name">
                    `;
                  }
                }
                withdrawMethod.addEventListener('change', updateDetails);
                updateDetails();

                // Close modal
                modal.querySelector('#close-withdraw-modal').onclick = () => modal.remove();
                modal.querySelector('#cancel-withdraw').onclick = () => modal.remove();

                // Submit withdrawal
                modal.querySelector('#confirm-withdraw').onclick = async () => {
                  const errorEl = modal.querySelector('#withdraw-error');
                  errorEl.classList.add('hidden');
                  const amount = parseFloat(modal.querySelector('#withdraw-amount').value);
                  if (isNaN(amount) || amount < 10) {
                    errorEl.textContent = 'Minimum withdrawal is $10';
                    errorEl.classList.remove('hidden');
                    return;
                  }
                  if (amount > currentUserBalance) {
                    errorEl.textContent = 'Insufficient balance';
                    errorEl.classList.remove('hidden');
                    return;
                  }
                  let details = {};
                  if (withdrawMethod.value === 'crypto') {
                    const address = modal.querySelector('#withdraw-crypto-address').value.trim();
                    const coin = modal.querySelector('#withdraw-crypto-type').value;
                    if (!address) {
                      errorEl.textContent = 'Please enter your crypto address';
                      errorEl.classList.remove('hidden');
                      return;
                    }
                    details = { address, coin };
                  } else {
                    const account = modal.querySelector('#withdraw-bank-account').value.trim();
                    const bank = modal.querySelector('#withdraw-bank-name').value.trim();
                    if (!account || !bank) {
                      errorEl.textContent = 'Please enter your bank details';
                      errorEl.classList.remove('hidden');
                      return;
                    }
                    details = { account, bank };
                  }
                  // Create withdrawal transaction (pending)
                  try {
                    const { error } = await supabaseClient
                      .from('transactions')
                      .insert([{
                        user_id: currentUser.id,
                        amount: -amount,
                        type: 'withdrawal',
                        status: 'pending',
                        description: withdrawMethod.value === 'crypto'
                          ? `Withdrawal to ${details.coin} address: ${details.address}`
                          : `Withdrawal to bank: ${details.bank}, account: ${details.account}`,
                        withdrawal_method: withdrawMethod.value,
                        withdrawal_details: JSON.stringify(details),
                        created_at: new Date().toISOString()
                      }]);
                    if (error) throw error;
                    // Optionally update balance immediately (or after admin approval)
                    await updateUserBalance(-amount);
                    alert('Withdrawal request submitted! You will be notified once processed.');
                    modal.remove();
                  } catch (err) {
                    errorEl.textContent = 'Error submitting withdrawal. Please try again.';
                    errorEl.classList.remove('hidden');
                  }
                };
                // Close modal on background click
                modal.addEventListener('click', (e) => {
                  if (e.target === modal) modal.remove();
                });
              }
            </script>
          </div>
        </div>

        <!-- Profile Edit Modal -->
        <div id="profile-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6 animate__animated animate__fadeInUp">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-bold text-gray-900">Edit Profile</h3>
              <button id="close-profile-modal" class="text-gray-500 hover:text-gray-700">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
            
            <div class="mb-6 text-center">
              <div class="relative inline-block">
                <img id="profile-preview" class="w-32 h-32 rounded-full object-cover mx-auto mb-4" src="https://randomuser.me/api/portraits/men/32.jpg" alt="Profile">
                <label for="profile-upload" class="absolute bottom-0 right-0 bg-blue-600 text-white p-2 rounded-full cursor-pointer hover:bg-blue-700">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                  <input id="profile-upload" type="file" class="hidden" accept="image/*">
                </label>
              </div>
            </div>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                <input id="profile-name" type="text" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <input id="profile-email" type="email" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                <input id="profile-phone" type="tel" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>
            </div>
            
            <div class="mt-6 flex justify-end space-x-3">
              <button id="cancel-profile-edit" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">
                Cancel
              </button>
              <button id="save-profile-btn" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700">
                Save Changes
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Initialize Supabase
const supabaseUrl = 'https://xjonomapbiphywjhezfj.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhqb25vbWFwYmlwaHl3amhlemZqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgxNTMzMTEsImV4cCI6MjA2MzcyOTMxMX0.iv93r6S6SFDeE44KfN7XrTG9LEy75wzvqXIfdADGcCo';
const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

// DOM Elements
const profileMenuButton = document.getElementById('profile-menu-button');
const profileMenu = document.getElementById('profile-menu');
const profileMenuItem = document.getElementById('profile-menu-item');
const profileModal = document.getElementById('profile-modal');
const closeProfileModal = document.getElementById('close-profile-modal');
const cancelProfileEdit = document.getElementById('cancel-profile-edit');
const profileUpload = document.getElementById('profile-upload');
const profilePreview = document.getElementById('profile-preview');
const saveProfileBtn = document.getElementById('save-profile-btn');
const logoutBtn = document.getElementById('logout-btn');
const quickDepositBtn = document.getElementById('quick-deposit-btn');
const proceedDepositBtn = document.getElementById('proceed-deposit-btn');
const startKycBtn = document.getElementById('start-kyc-btn');
const profileMenuMain = document.getElementById('Profile_main');
const profileP = document.getElementById('profileP');

// User data
let currentUser = null;
let userProfile = null;
let currentUserBalance = 0;
let transactions = [];
let investmentPlans = [];
let userInvestments = [];

// Supported cryptocurrencies
const cryptoOptions = [
  { id: 'bitcoin', name: 'Bitcoin (BTC)', address: 'bc1qqjk8uquf68ucuvza597aqglcanlpwu8xj8d3qg' },
  { id: 'ethereum', name: 'Ethereum (ETH)', address: '0x386ED7e5cE5F218cC02f8f6b0927927623711657' },
  { id: 'usdt', name: 'Tether (USDT)', address: '0x386ED7e5cE5F218cC02f8f6b0927927623711657' },
  { id: 'bnb', name: 'XRP (XRP)', address: 'rNFugeoj3ZN8Wv6xhuLegUBBPXKCyWLRkB    memo:1880135565 '}
];

// Initialize the app when DOM is loaded
document.addEventListener('DOMContentLoaded', async () => {
  await checkAuth();
  await fetchUserProfile();
  await fetchUserBalance();
  await fetchTransactions();
  await fetchInvestmentPlans();
  await fetchUserInvestments();
  updateDashboard();
  setupEventListeners();
});

// Check authentication status
async function checkAuth() {
  const { data: { user }, error } = await supabaseClient.auth.getUser();
  
  if (error || !user) {
    window.location.href = 'login.html';
    return;
  }
  
  currentUser = user;
  updateProfileUI();
}

// Fetch user profile from database
async function fetchUserProfile() {
  const { data, error } = await supabaseClient
    .from('profiles')
    .select('*')
    .eq('id', currentUser.id)
    .single();
    
  if (error) {
    console.error('Error fetching profile:', error);
    return;
  }
  
  userProfile = data;
  
  // If profile doesn't exist, create one
  if (!userProfile) {
    await createUserProfile();
  }
  
  updateProfileUI();
  updateKycProgress(userProfile.kyc_progress || 0);
}

// Create user profile if it doesn't exist
async function createUserProfile() {
  const { data, error } = await supabaseClient
    .from('profiles')
    .insert([
      { 
        id: currentUser.id,
        full_name: currentUser.email.split('@')[0],
        avatar_url: `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.email.split('@')[0])}&background=random`
      }
    ])
    .select()
    .single();
    
  if (error) {
    console.error('Error creating profile:', error);
    return;
  }
  
  userProfile = data;
}

// Fetch user balance from database
async function fetchUserBalance() {
  const { data, error } = await supabaseClient
    .from('user_balances')
    .select('balance')
    .eq('user_id', currentUser.id)
    .single();

  if (error) {
    // If no record exists, create one
    if (error.code === 'PGRST116') {
      await createUserBalance();
      return fetchUserBalance();
    }
    console.error('Error fetching balance:', error);
    return 0;
  }
  
  currentUserBalance = data.balance || 0;
  return currentUserBalance;
}

// Create initial balance record
async function createUserBalance() {
  const { error } = await supabaseClient
    .from('user_balances')
    .insert([{ user_id: currentUser.id, balance: 0 }]);
    
  if (error) console.error('Error creating balance:', error);
}

// Update balance in database
async function updateUserBalance(changeAmount) {
  const newBalance = currentUserBalance + changeAmount;
  
  const { error } = await supabaseClient
    .from('user_balances')
    .upsert({ 
      user_id: currentUser.id,
      balance: newBalance 
    });
    
  if (error) {
    console.error('Error updating balance:', error);
    return false;
  }
  
  currentUserBalance = newBalance;
  updateDashboard();
  return true;
}

// Fetch user transactions
async function fetchTransactions() {
  const { data, error } = await supabaseClient
    .from('transactions')
    .select('*')
    .eq('user_id', currentUser.id)
    .order('created_at', { ascending: false })
    .limit(5);
    
  if (error) {
    console.error('Error fetching transactions:', error);
    return;
  }
  
  transactions = data;
  renderTransactions();
}

// Fetch investment plans
async function fetchInvestmentPlans() {
  const { data, error } = await supabaseClient
    .from('investment_plans')
    .select('*');
    
  if (error) {
    console.error('Error fetching investment plans:', error);
    return;
  }
  
  investmentPlans = data;
  renderInvestmentPlans();
}

// Fetch user investments
async function fetchUserInvestments() {
  const { data, error } = await supabaseClient
    .from('user_investments')
    .select('*, investment_plans(*)')
    .eq('user_id', currentUser.id)
    .order('created_at', { ascending: false });
    
  if (error) {
    console.error('Error fetching user investments:', error);
    return;
  }
  
  userInvestments = data;
  updateDashboard();
}

// Update dashboard with user data
function updateDashboard() {
  // Welcome message
  document.getElementById('welcome-message').textContent = `Welcome back, ${userProfile?.full_name || currentUser?.email || 'User'}`;
  
  // Update balance display
  document.getElementById('total-balance').textContent = `$${currentUserBalance.toFixed(2)}`;
  
  // Calculate active investments
  const activeInvestments = userInvestments
    .filter(inv => inv.status === 'active')
    .reduce((sum, inv) => sum + inv.amount, 0);
  
  document.getElementById('active-investments').textContent = `$${activeInvestments.toFixed(2)}`;
  document.getElementById('active-plans-count').textContent = 
    `${userInvestments.filter(inv => inv.status === 'active').length} active plans`;
}

// Update profile UI elements
function updateProfileUI() {
  // Sidebar profile
  document.getElementById('sidebar-profile-name').textContent = userProfile?.full_name || currentUser?.email || 'User';
  document.getElementById('sidebar-profile-email').textContent = currentUser?.email || '';
  document.getElementById('sidebar-profile-img').src = userProfile?.avatar_url || 'https://randomuser.me/api/portraits/men/32.jpg';
  
  // Top navigation profile
  document.getElementById('topnav-profile-name').textContent = userProfile?.full_name || currentUser?.email || 'User';
  document.getElementById('topnav-profile-img').src = userProfile?.avatar_url || 'https://randomuser.me/api/portraits/men/32.jpg';

  // Mobile profile
  document.getElementById('mobile-profile-name').textContent = userProfile?.full_name || currentUser?.email || 'User';
  document.getElementById('mobile-profile-email').textContent = currentUser?.email || '';
  document.getElementById('mobile-profile-img').src = userProfile?.avatar_url || 'https://randomuser.me/api/portraits/men/32.jpg';
}

// Render transactions list
function renderTransactions() {
  const container = document.getElementById('transactions-list');
  container.innerHTML = '';
  
  if (transactions.length === 0) {
    container.innerHTML = '<div class="p-6 text-center text-gray-500">No transactions found</div>';
    return;
  }
  
  transactions.forEach(transaction => {
    const transactionEl = document.createElement('div');
    transactionEl.className = 'p-4 hover:bg-gray-50 transition';
    
    const typeClass = transaction.type === 'deposit' || transaction.type === 'dividend' 
      ? 'text-green-500' 
      : 'text-red-500';
    
    const icon = transaction.type === 'deposit' 
      ? '<svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>'
      : '<svg class="w-5 h-5 text-red-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path></svg>';
    
    transactionEl.innerHTML = `
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          ${icon}
          <div>
            <p class="text-sm font-medium text-gray-900">${transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1)}</p>
            <p class="text-xs text-gray-500">${new Date(transaction.created_at).toLocaleString()}</p>
          </div>
        </div>
        <div class="text-right">
          <p class="text-sm font-medium ${typeClass}">${transaction.type === 'deposit' || transaction.type === 'dividend' ? '+' : '-'}$${transaction.amount.toFixed(2)}</p>
          <p class="text-xs text-gray-500">${transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1)}</p>
        </div>
      </div>
    `;
    
    container.appendChild(transactionEl);
  });
}

// Render investment plans
function renderInvestmentPlans() {
  const container = document.getElementById('investment-plans');
  container.innerHTML = '';
  
  if (investmentPlans.length === 0) {
    container.innerHTML = '<div class="p-6 text-center text-gray-500">No investment plans available</div>';
    return;
  }
  
  investmentPlans.forEach(plan => {
    const planEl = document.createElement('div');
    planEl.className = 'p-4 hover:bg-gray-50 transition cursor-pointer';
    
    const dailyReturn = (plan.daily_interest * 100).toFixed(2);
    const totalReturn = (plan.daily_interest * plan.duration_days * 100).toFixed(2);
    
    planEl.innerHTML = `
      <div class="flex items-start justify-between">
        <div>
          <h4 class="font-medium text-gray-900">${plan.name}</h4>
          <p class="text-sm text-gray-500">${plan.description || 'High return investment plan'}</p>
        </div>
        <span class="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">
          ${dailyReturn}% daily
        </span>
      </div>
      <div class="mt-3 grid grid-cols-3 gap-2 text-center">
        <div>
          <p class="text-xs text-gray-500">Min Amount</p>
          <p class="text-sm font-medium">$${plan.min_amount.toFixed(2)}</p>
        </div>
        <div>
          <p class="text-xs text-gray-500">Duration</p>
          <p class="text-sm font-medium">${plan.duration_days} days</p>
        </div>
        <div>
          <p class="text-xs text-gray-500">Total Return</p>
          <p class="text-sm font-medium">${totalReturn}%</p>
        </div>
      </div>
      <button class="mt-3 w-full bg-blue-600 hover:bg-blue-700 text-white text-sm py-2 px-4 rounded-lg invest-btn" data-plan-id="${plan.id}">
        Invest Now
      </button>
    `;
    
    container.appendChild(planEl);
  });
  
  // Add event listeners to invest buttons
  document.querySelectorAll('.invest-btn').forEach(button => {
    button.addEventListener('click', (e) => {
      const planId = e.target.getAttribute('data-plan-id');
      openInvestModal(planId);
    });
  });
}

// Open invest modal

// Open deposit modal with cryptocurrency selection
function openDepositModal() {
  const cryptoOptionsHtml = cryptoOptions.map(crypto => `
    <option value="${crypto.id}">${crypto.name}</option>
  `).join('');

  const modalHtml = `
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6 animate__animated animate__fadeInUp">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-gray-900">Make a Deposit</h3>
          <button id="close-deposit-modal" class="text-gray-500 hover:text-gray-700">
            ✕
          </button>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">Amount ($)</label>
          <input id="deposit-amount" type="number" min="10" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter amount">
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">Payment Method</label>
          <select id="deposit-method" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="credit_card">Credit/Debit Card</option>
            <option value="bank_transfer">Bank Transfer</option>
            <option value="crypto">Cryptocurrency</option>
          </select>
        </div>
        
        <div id="crypto-selection" class="mb-4 hidden">
          <label class="block text-sm font-medium text-gray-700 mb-1">Select Cryptocurrency</label>
          <select id="crypto-type" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            ${cryptoOptionsHtml}
          </select>
        </div>
        
        <div class="mt-6 flex justify-end space-x-3">
          <button id="cancel-deposit" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">
            Cancel
          </button>
          <button id="confirm-deposit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700">
            Proceed to Payment
          </button>
        </div>
      </div>
    </div>
  `;
  
  const modal = document.createElement('div');
  modal.innerHTML = modalHtml;
  document.body.appendChild(modal);
  
  // Show/hide crypto selection based on payment method
  const depositMethod = document.getElementById('deposit-method');
  const cryptoSelection = document.getElementById('crypto-selection');
  
  depositMethod.addEventListener('change', () => {
    cryptoSelection.classList.toggle('hidden', depositMethod.value !== 'crypto');
  });
  
  // Add event listeners
  document.getElementById('close-deposit-modal').addEventListener('click', () => {
    modal.remove();
  });
  
  document.getElementById('cancel-deposit').addEventListener('click', () => {
    modal.remove();
  });
  
  document.getElementById('confirm-deposit').addEventListener('click', async () => {
    const amount = parseFloat(document.getElementById('deposit-amount').value);
    const method = document.getElementById('deposit-method').value;
    const cryptoType = method === 'crypto' ? document.getElementById('crypto-type').value : null;
    
    if (isNaN(amount)) {
      alert('Please enter a valid amount');
      return;
    }
    
    // Remove the first modal
    modal.remove();
    
    // Show payment details modal
    showPaymentDetailsModal(amount, method, cryptoType);
  });
}

// Copy to clipboard function
async function copyToClipboard(text, buttonId) {
  try {
    await navigator.clipboard.writeText(text);
    const button = document.getElementById(buttonId);
    const originalText = button.textContent;
    button.textContent = 'Copied!';
    button.classList.add('bg-green-500', 'text-white');
    
    setTimeout(() => {
      button.textContent = originalText;
      button.classList.remove('bg-green-500', 'text-white');
    }, 2000);
  } catch (err) {
    // Fallback method for older browsers
    const textArea = document.createElement('textarea');
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
      document.execCommand('copy');
      const button = document.getElementById(buttonId);
      const originalText = button.textContent;
      button.textContent = 'Copied!';
      button.classList.add('bg-green-500', 'text-white');
      
      setTimeout(() => {
        button.textContent = originalText;
        button.classList.remove('bg-green-500', 'text-white');
      }, 2000);
    } catch (fallbackErr) {
      console.error('Copy to clipboard failed:', fallbackErr);
      alert('Copy failed. Please copy manually.');
    }
    
    document.body.removeChild(textArea);
  }
}

// Show payment details modal
function showPaymentDetailsModal(amount, method, cryptoType = null) {
  // Get payment details based on method
  let paymentDetails = {};
  
  if (method === 'credit_card') {
    paymentDetails = {
      title: 'Credit/Debit Card Payment',
      instructions: 'Complete the payment using your card details',
      address: 'Not applicable - will be processed by payment gateway'
    };
  } 
  else if (method === 'bank_transfer') {
    paymentDetails = {
      title: 'Bank Transfer',
      instructions: 'Transfer the amount to our bank account',
       address: 'Not applicable - will be processed by payment gateway'
    };
  } 
  else if (method === 'crypto') {
    const selectedCrypto = cryptoOptions.find(c => c.id === cryptoType) || cryptoOptions[0];
    paymentDetails = {
      title: `${selectedCrypto.name} Payment`,
      instructions: `Send exactly ${amount} USD worth of ${selectedCrypto.name.split(' ')[0]} to our wallet address`,
      address: selectedCrypto.address
    };
  }

  const modalHtml = `
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6 animate__animated animate__fadeInUp">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-gray-900">${paymentDetails.title}</h3>
          <button id="close-payment-modal" class="text-gray-500 hover:text-gray-700">
            ✕
          </button>
        </div>
        
        <div class="mb-4">
          <p class="text-sm font-medium text-gray-700">Amount to Deposit:</p>
          <p class="text-lg font-bold">$${amount.toFixed(2)}</p>
        </div>
        
        <div class="mb-4">
          ${method === 'bank_transfer' ? `
            <p class="text-sm font-medium text-gray-700 mb-2">Bank Transfer Details:</p>
            <div class="space-y-2">
              <div class="p-3 bg-gray-100 rounded-lg">
                <div class="flex justify-between items-center">
                  <div>
                    <p class="text-xs text-gray-500">Account Number</p>
                    <p class="text-sm font-mono break-all">${paymentDetails.address}</p>
                  </div>
                  <button id="copy-account" onclick="copyToClipboard('${paymentDetails.address}', 'copy-account')" class="ml-2 px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                    Copy
                  </button>
                </div>
              </div>
              <div class="p-3 bg-gray-100 rounded-lg">
                <div class="flex justify-between items-center">
                  <div>
                    <p class="text-xs text-gray-500">Bank Name</p>
                    <p class="text-sm font-mono">${paymentDetails.bankName}</p>
                  </div>
                  <button id="copy-bank" onclick="copyToClipboard('${paymentDetails.bankName}', 'copy-bank')" class="ml-2 px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                    Copy
                  </button>
                </div>
              </div>
              <div class="p-3 bg-gray-100 rounded-lg">
                <div class="flex justify-between items-center">
                  <div>
                    <p class="text-xs text-gray-500">SWIFT Code</p>
                    <p class="text-sm font-mono">${paymentDetails.swift}</p>
                  </div>
                  <button id="copy-swift" onclick="copyToClipboard('${paymentDetails.swift}', 'copy-swift')" class="ml-2 px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                    Copy
                  </button>
                </div>
              </div>
              <div class="pt-2">
                <button id="copy-all-bank" onclick="copyToClipboard('${paymentDetails.fullDetails}', 'copy-all-bank')" class="w-full px-3 py-2 text-sm bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors">
                  Copy All Details
                </button>
              </div>
            </div>
          ` : method === 'crypto' ? `
            <p class="text-sm font-medium text-gray-700">Wallet Address:</p>
            <div class="mt-2 p-3 bg-gray-100 rounded-lg">
              <div class="flex justify-between items-center">
                <p class="text-sm font-mono break-all flex-1 mr-2">${paymentDetails.address}</p>
                <button id="copy-address" onclick="copyToClipboard('${paymentDetails.address}', 'copy-address')" class="px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors whitespace-nowrap">
                  Copy Address
                </button>
              </div>
            </div>
          ` : `
            <p class="text-sm font-medium text-gray-700">Payment Address:</p>
            <div class="mt-2 p-3 bg-gray-100 rounded-lg">
              <p class="text-sm font-mono break-all">${paymentDetails.address}</p>
             
            </div>
            
          `}
          <p class="text-xs text-gray-500 mt-2">${paymentDetails.instructions}</p>
        </div>
        
        ${method !== 'credit_card' ? `
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">Upload Payment Proof</label>
          <input id="payment-proof" type="file" accept="image/*" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          <p class="text-xs text-gray-500 mt-1">Upload a screenshot of your transaction confirmation (Max 5MB)</p>
          <div id="upload-status" class="text-xs mt-1"></div>
        </div>
        ` : ''}
        
        <div class="mt-6 flex justify-end space-x-3">
          <button id="cancel-payment" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">
            Cancel
          </button>
          <button id="submit-payment" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed">
            Submit Payment
          </button>
        </div>
      </div>
    </div>
  `;
  
  const paymentModal = document.createElement('div');
  paymentModal.innerHTML = modalHtml;
  document.body.appendChild(paymentModal);
  
  // Make copyToClipboard function available globally for this modal
  window.copyToClipboard = copyToClipboard;
  
  // Status update function
  function updateStatus(message, isError = false) {
    const statusElement = document.getElementById('upload-status');
    if (statusElement) {
      statusElement.textContent = message;
      statusElement.className = `text-xs mt-1 ${isError ? 'text-red-500' : 'text-green-500'}`;
    }
  }
  
  // File validation function
  function validateFile(file) {
    if (!file) return { valid: false, message: 'No file selected' };
    
    // Check file size (5MB limit)
    if (file.size > 5 * 1024 * 1024) {
      return { valid: false, message: 'File size too large. Please upload a file smaller than 5MB.' };
    }
    
    // Check file type
    if (!file.type.startsWith('image/')) {
      return { valid: false, message: 'Please upload an image file only.' };
    }
    
    return { valid: true, message: 'File looks good!' };
  }
  
  // Add file change listener for validation
  if (method !== 'credit_card') {
    const fileInput = document.getElementById('payment-proof');
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const validation = validateFile(file);
        updateStatus(validation.message, !validation.valid);
      } else {
        updateStatus('');
      }
    });
  }
  
  // Add event listeners
  document.getElementById('close-payment-modal').addEventListener('click', () => {
    paymentModal.remove();
  });
  
  document.getElementById('cancel-payment').addEventListener('click', () => {
    paymentModal.remove();
  });
  
  document.getElementById('submit-payment').addEventListener('click', async () => {
    const submitButton = document.getElementById('submit-payment');
    const paymentProof = method !== 'credit_card' ? document.getElementById('payment-proof').files[0] : null;
    
    // Disable submit button
    submitButton.disabled = true;
    submitButton.textContent = 'Processing...';
    
    try {
      // For non-credit card payments, require proof
      if (method !== 'credit_card' && !paymentProof) {
        updateStatus('Please upload payment proof', true);
        return;
      }
      
      // Check authentication
      const { data: { user }, error: authError } = await supabaseClient.auth.getUser();
      if (authError || !user) {
        updateStatus('Authentication error. Please log in again.', true);
        return;
      }
      
      // Validate file if exists
      if (paymentProof) {
        const validation = validateFile(paymentProof);
        if (!validation.valid) {
          updateStatus(validation.message, true);
          return;
        }
      }
      
      let paymentProofUrl = '';
      
      // Upload payment proof if exists
      if (paymentProof) {
        updateStatus('Uploading payment proof...');
        
        const fileExt = paymentProof.name.split('.').pop();
        const fileName = `${Date.now()}.${fileExt}`;
        const filePath = `payment-proofs/${currentUser.id}/${fileName}`;
        
        console.log('Uploading file:', {
          path: filePath,
          size: paymentProof.size,
          type: paymentProof.type,
          name: paymentProof.name
        });
        
        // Try upload with detailed error handling
        const { data, error: uploadError } = await supabaseClient.storage
          .from('digibit')
          .upload(filePath, paymentProof, {
            contentType: paymentProof.type,
            upsert: false,
            duplex: 'half' // This can help with some upload issues
          });

        if (uploadError) {
          console.error('Upload error details:', uploadError);
          
          // Handle specific error cases
          if (uploadError.message.includes('Bucket not found')) {
            updateStatus('Storage bucket not found. Please contact support.', true);
          } else if (uploadError.message.includes('not allowed')) {
            updateStatus('Upload not allowed. Please contact support.', true);
          } else if (uploadError.message.includes('size')) {
            updateStatus('File too large. Please use a smaller file.', true);
          } else {
            updateStatus(`Upload failed: ${uploadError.message}`, true);
          }
          return;
        }

        // Get public URL
        const { data: urlData } = supabaseClient.storage
          .from('digibit')
          .getPublicUrl(filePath);
        
        paymentProofUrl = urlData.publicUrl;
        updateStatus('Payment proof uploaded successfully!');
        console.log('Upload successful, URL:', paymentProofUrl);
      }
      
      // Create a pending transaction (admin will approve)
      updateStatus('Creating transaction record...');
      
      const { data: transactionData, error: dbError } = await supabaseClient
        .from('transactions')
        .insert([{
          user_id: currentUser.id,
          amount: amount,
          type: 'deposit',
          status: 'pending', // Will be changed to 'completed' after admin approval
          description: `Deposit via ${method.replace('_', ' ')}${cryptoType ? ' (' + cryptoType + ')' : ''}`,
          payment_method: method,
          payment_proof: paymentProofUrl,
          crypto_type: cryptoType,
          wallet_address: method !== 'credit_card' ? paymentDetails.address : null,
          created_at: new Date().toISOString()
        }])
        .select();
        
      if (dbError) {
        console.error('Database error:', dbError);
        updateStatus(`Database error: ${dbError.message}`, true);
        return;
      }
      
      updateStatus('Transaction submitted successfully!');
      
      // Show success message
      setTimeout(() => {
        alert('Deposit request submitted! Your transaction will be processed after verification.');
        paymentModal.remove();
      }, 1000);
      
    } catch (error) {
      console.error('Error submitting payment:', error);
      updateStatus(`Error: ${error.message || 'Please try again.'}`, true);
    } finally {
      // Re-enable submit button
      submitButton.disabled = false;
      submitButton.textContent = 'Submit Payment';
    }
  });
  
  // Close modal on background click
  paymentModal.addEventListener('click', (e) => {
    if (e.target === paymentModal) {
      paymentModal.remove();
    }
  });
}
// Update KYC progress
function updateKycProgress(percent) {
  const circle = document.getElementById('kyc-progress-ring');
  const circumference = 2 * Math.PI * 16;
  const offset = circumference - (percent / 100) * circumference;
  
  circle.style.strokeDashoffset = offset;
  document.getElementById('kyc-percent').textContent = `${percent}%`;
  
  if (percent === 0) {
    document.getElementById('kyc-status').textContent = 'Verification not started';
    startKycBtn.textContent = 'Start Verification';
    startKycBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
    startKycBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
  } else if (percent < 100) {
    document.getElementById('kyc-status').textContent = 'Verification in progress';
    startKycBtn.textContent = 'Continue Verification';
    startKycBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
    startKycBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
  } else {
    document.getElementById('kyc-status').textContent = 'Verification complete!';
    startKycBtn.textContent = 'Verified';
    startKycBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
    startKycBtn.classList.add('bg-green-500', 'hover:bg-green-600');
  }
}

// Setup all event listeners
function setupEventListeners() {
  // Profile dropdown functionality
  profileMenuButton.addEventListener('click', (e) => {
    e.stopPropagation();
    profileMenu.classList.toggle('hidden');
  });

  // Close dropdown when clicking outside
  document.addEventListener('click', () => {
    profileMenu.classList.add('hidden');
  });

  // Profile menu item click
  profileMenuItem.addEventListener('click', (e) => {
    e.preventDefault();
    openProfileModal();
    profileMenu.classList.add('hidden');
  });

 if (profileP) {
    profileP.addEventListener('click', (e) => {
      e.preventDefault();
      openProfileModal();
      // No dropdown to hide in mobile nav
    });
  }

  // Mobile profile menu item click
  if (profileMenuMain) {
    profileMenuMain.addEventListener('click', (e) => {
      e.preventDefault();
      openProfileModal();
      // No dropdown to hide in mobile nav
    });
  }
  // Close profile modal
  closeProfileModal.addEventListener('click', closeProfileModalFunc);
  cancelProfileEdit.addEventListener('click', closeProfileModalFunc);

  // Handle profile image upload
  profileUpload.addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    // Create preview
    const reader = new FileReader();
    reader.onload = (e) => {
      profilePreview.src = e.target.result;
    };
    reader.readAsDataURL(file);

    // Upload to Supabase Storage
    const fileExt = file.name.split('.').pop();
    const filePath = `profile-images/${currentUser.id}/${Date.now()}.${fileExt}`;
    
    try {
      // First delete old image if exists
      if (userProfile.avatar_url) {
        const oldPath = userProfile.avatar_url.split('/').pop();
        await supabaseClient.storage.from('digibit').remove([`profile-images/${currentUser.id}/${oldPath}`]);
      }

      const { error: uploadError } = await supabaseClient.storage
        .from('digibit')
        .upload(filePath, file);

      if (uploadError) throw uploadError;

      // Get public URL
      const { data: { publicUrl } } = supabaseClient.storage
        .from('digibit')
        .getPublicUrl(filePath);

      // Update user profile in database
      const { error: updateError } = await supabaseClient
        .from('profiles')
        .update({ avatar_url: publicUrl })
        .eq('id', currentUser.id);

      if (updateError) throw updateError;

      // Update UI
      userProfile.avatar_url = publicUrl;
      updateProfileUI();
    } catch (error) {
      console.error('Error uploading image:', error);
      alert('Error uploading profile image. Please try again.');
    }
  });

  // Save profile changes
  saveProfileBtn.addEventListener('click', async () => {
    const fullName = document.getElementById('profile-name').value;
    const phone = document.getElementById('profile-phone').value;

    try {
      const { error } = await supabaseClient
        .from('profiles')
        .update({ 
          full_name: fullName,
          phone: phone
        })
        .eq('id', currentUser.id);

      if (error) throw error;

      // Update local data
      userProfile.full_name = fullName;
      userProfile.phone = phone;
      
      // Update UI
      updateProfileUI();
      closeProfileModalFunc();
    } catch (error) {
      console.error('Error updating profile:', error);
      alert('Error updating profile. Please try again.');
    }
  });

  // Logout
  logoutBtn.addEventListener('click', async () => {
    try {
      const { error } = await supabaseClient.auth.signOut();
      if (error) throw error;
      
      // Redirect to login page
      window.location.href = 'login.html';
    } catch (error) {
      console.error('Error logging out:', error);
      alert('Error logging out. Please try again.');
    }
  });

  // Deposit buttons
  quickDepositBtn.addEventListener('click', () => {
    // Scroll to deposit section
    document.querySelector('#proceed-deposit-btn').scrollIntoView({ behavior: 'smooth' });
  });

  proceedDepositBtn.addEventListener('click', () => {
    openDepositModal();
  });

  // KYC Verification
  startKycBtn.addEventListener('click', () => {
    openKycModal();
  });
}

// Open profile modal
function openProfileModal() {
  // Fill form with current user data
  document.getElementById('profile-name').value = userProfile?.full_name || '';
  document.getElementById('profile-email').value = currentUser?.email || '';
  document.getElementById('profile-phone').value = userProfile?.phone || '';
  profilePreview.src = userProfile?.avatar_url || 'https://randomuser.me/api/portraits/men/32.jpg';
  
  profileModal.classList.remove('hidden');
}

function closeProfileModalFunc() {
  profileModal.classList.add('hidden');
}

// Open KYC modal
function openKycModal() {
  const modalHtml = `
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6 animate__animated animate__fadeInUp">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-gray-900">KYC Verification</h3>
          <button id="close-kyc-modal" class="text-gray-500 hover:text-gray-700">
            ✕
          </button>
        </div>
        
        <div class="mb-4">
          <p class="text-gray-600 mb-4">Please complete the following steps to verify your identity:</p>
          
          <div class="space-y-4">
            <div class="flex items-center">
              <input id="kyc-step1" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" ${userProfile.kyc_progress >= 25 ? 'checked' : ''}>
              <label for="kyc-step1" class="ml-2 block text-sm text-gray-700">Personal Information</label>
            </div>
            
            <div class="flex items-center">
              <input id="kyc-step2" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" ${userProfile.kyc_progress >= 50 ? 'checked' : ''}>
              <label for="kyc-step2" class="ml-2 block text-sm text-gray-700">ID Verification</label>
            </div>
            
            <div class="flex items-center">
              <input id="kyc-step3" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" ${userProfile.kyc_progress >= 75 ? 'checked' : ''}>
              <label for="kyc-step3" class="ml-2 block text-sm text-gray-700">Address Verification</label>
            </div>
            
            <div class="flex items-center">
              <input id="kyc-step4" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" ${userProfile.kyc_progress >= 100 ? 'checked' : ''}>
              <label for="kyc-step4" class="ml-2 block text-sm text-gray-700">Selfie Verification</label>
            </div>
          </div>
        </div>
        
        <div class="mt-6 flex justify-end space-x-3">
          <button id="cancel-kyc" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">
            Cancel
          </button>
          <button id="save-kyc" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700">
            Save Progress
          </button>
        </div>
      </div>
    </div>
  `;
  
  const modal = document.createElement('div');
  modal.innerHTML = modalHtml;
  document.body.appendChild(modal);
  
  // Add event listeners
  document.getElementById('close-kyc-modal').addEventListener('click', () => {
    modal.remove();
  });
  
  document.getElementById('cancel-kyc').addEventListener('click', () => {
    modal.remove();
  });
  
  document.getElementById('save-kyc').addEventListener('click', async () => {
    const step1 = document.getElementById('kyc-step1').checked;
    const step2 = document.getElementById('kyc-step2').checked;
    const step3 = document.getElementById('kyc-step3').checked;
    const step4 = document.getElementById('kyc-step4').checked;
    
    let progress = 0;
    if (step1) progress += 25;
    if (step2) progress += 25;
    if (step3) progress += 25;
    if (step4) progress += 25;
    
    try {
      const { error } = await supabaseClient
        .from('profiles')
        .update({ 
          kyc_progress: progress,
          kyc_status: progress === 100 ? 'verified' : 'in_progress'
        })
        .eq('id', currentUser.id);

      if (error) throw error;

      // Update local data
      userProfile.kyc_progress = progress;
      userProfile.kyc_status = progress === 100 ? 'verified' : 'in_progress';
      
      // Update UI
      updateKycProgress(progress);
      modal.remove();
    } catch (error) {
      console.error('Error updating KYC:', error);
      alert('Error updating KYC progress. Please try again.');
    }
  });
}

// Simple invest function

// Define the investment plans
const investmentPlan = [
  {
    id: 'beginner',
    name: 'Beginner Plan',
    min_amount: 100,
    max_amount: 1000,
    daily_interest: 0.10, // 10% daily
    duration_days: 30,
    description: 'Perfect for new investors starting their journey'
  },
  {
    id: 'advanced',
    name: 'Advanced Plan',
    min_amount: 1000,
    max_amount: 10000,
    daily_interest: 0.20, // 20% daily
    duration_days: 30,
    description: 'For experienced investors looking for higher returns'
  },
  {
    id: 'pro',
    name: 'Pro Trader Plan',
    min_amount: 10000,
    max_amount: 50000,
    daily_interest: 0.30, // 30% daily
    duration_days: 30,
    description: 'Maximum returns for professional investors'
  }
];

// Global variable to track selected plan
let selectedPlan = null;

// Main invest function - shows plan selection first
function invest() {
  // Create plan selection modal
  const plansHtml = investmentPlan.map(plan => {
    const totalReturn = (plan.daily_interest * plan.duration_days * 100).toFixed(0);
    return `
      <div class="p-4 border rounded-lg mb-3 cursor-pointer hover:bg-gray-50 transition-colors plan-option"
           data-plan-id="${plan.id}">
        <div class="flex justify-between items-start">
          <div>
            <h4 class="font-bold text-lg">${plan.name}</h4>
            <p class="text-sm text-gray-600">${plan.description}</p>
          </div>
          <span class="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">
            ${totalReturn}% total
          </span>
        </div>
        <div class="mt-3 grid grid-cols-3 gap-2 text-center">
          <div>
            <p class="text-xs text-gray-500">Min Amount</p>
            <p class="text-sm font-medium">$${plan.min_amount.toFixed(2)}</p>
          </div>
          <div>
            <p class="text-xs text-gray-500">Duration</p>
            <p class="text-sm font-medium">${plan.duration_days} days</p>
          </div>
          <div>
            <p class="text-xs text-gray-500">Daily Return</p>
            <p class="text-sm font-medium">${(plan.daily_interest * 100).toFixed(2)}%</p>
          </div>
        </div>
      </div>
    `;
  }).join('');

  const modalHtml = `
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-gray-900">Choose Investment Plan</h3>
          <button id="close-plan-modal" class="text-gray-500 hover:text-gray-700">
            ✕
          </button>
        </div>

        <div id="plan-selection" class="mb-4">
          ${plansHtml}
        </div>

        <div class="text-center text-sm text-gray-500">
          Your available balance: $${currentUserBalance.toFixed(2)}
        </div>
      </div>
    </div>
  `;

  const modal = document.createElement('div');
  modal.innerHTML = modalHtml;
  document.body.appendChild(modal);

  // Close modal handler
  document.getElementById('close-plan-modal').addEventListener('click', () => {
    modal.remove();
  });

  // Plan selection handler - FIXED: Changed investmentPlans to investmentPlan
  document.querySelectorAll('.plan-option').forEach(option => {
    option.addEventListener('click', () => {
      selectedPlan = investmentPlan.find(p => p.id === option.dataset.planId);
      modal.remove();
      openInvestAmountModal();
    });
  });
}

// Show investment amount form after plan selection
function openInvestAmountModal() {
  // Check if selectedPlan exists first
  if (!selectedPlan) {
    alert('No plan selected. Please select a plan first.');
    return;
  }
  
  // Now show the correct alert with plan name
  alert('You have selected the ' + selectedPlan.name);
  
  // Create amount input modal
  const modalHtml = `
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-gray-900">Invest in ${selectedPlan.name}</h3>
          <button id="close-amount-modal" class="text-gray-500 hover:text-gray-700">
            ✕
          </button>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">Amount ($)</label>
          <input id="invest-amount" type="number" 
            min="${selectedPlan.min_amount}" 
            ${selectedPlan.max_amount ? `max="${selectedPlan.max_amount}"` : ''}
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            placeholder="$${selectedPlan.min_amount} - ${selectedPlan.max_amount || 'unlimited'}">
        </div>

        <div class="mb-4">
          <p class="text-sm text-gray-600">Your balance: $${currentUserBalance.toFixed(2)}</p>
          <p class="text-sm text-gray-600">Expected daily return: $<span id="daily-return">0.00</span></p>
          <p class="text-sm text-gray-600">Total return after ${selectedPlan.duration_days} days: $<span id="total-return">0.00</span></p>
        </div>

        <div id="invest-error" class="text-red-600 mb-4 hidden"></div>

        <div class="mt-6 flex justify-end space-x-3">
          <button id="back-to-plans" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">
            Back
          </button>
          <button id="confirm-invest" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700">
            Confirm Investment
          </button>
        </div>
      </div>
    </div>
  `;

  const modal = document.createElement('div');
  modal.innerHTML = modalHtml;
  document.body.appendChild(modal);

  // Calculate returns when amount changes
  document.getElementById('invest-amount').addEventListener('input', (e) => {
    const amount = parseFloat(e.target.value) || 0;
    const dailyReturn = amount * selectedPlan.daily_interest;
    const totalReturn = dailyReturn * selectedPlan.duration_days;
    
    document.getElementById('daily-return').textContent = dailyReturn.toFixed(2);
    document.getElementById('total-return').textContent = totalReturn.toFixed(2);
  });

  // Close modal handler
  document.getElementById('close-amount-modal').addEventListener('click', () => {
    modal.remove();
  });

  // Back to plans handler
  document.getElementById('back-to-plans').addEventListener('click', () => {
    modal.remove();
    invest(); // Reopen plan selection
  });

  // Confirm investment handler
  document.getElementById('confirm-invest').addEventListener('click', async () => {
    const errorEl = document.getElementById('invest-error');
    errorEl.classList.add('hidden');
    
    const amount = parseFloat(document.getElementById('invest-amount').value);
    
    // Validation
    if (isNaN(amount) || amount <= 0) {
      showError(errorEl, 'Please enter a valid amount');
      return;
    }
    
    if (amount < selectedPlan.min_amount) {
      showError(errorEl, `Minimum investment is $${selectedPlan.min_amount.toFixed(2)}`);
      return;
    }
    
    if (selectedPlan.max_amount && amount > selectedPlan.max_amount) {
      showError(errorEl, `Maximum investment is $${selectedPlan.max_amount.toFixed(2)}`);
      return;
    }
    
    // Balance check
    if (amount > currentUserBalance) {
      showError(errorEl, 'Insufficient balance. Please deposit first.');
      modal.remove();
      openDepositModal();
      return;
    }
    
    try {
      // First update balance
      const balanceUpdated = await updateUserBalance(-amount);
      if (!balanceUpdated) throw new Error('Balance update failed');
      
      // Create investment
      const startDate = new Date();
      const endDate = new Date();
      endDate.setDate(startDate.getDate() + selectedPlan.duration_days);
      
      // Send as numeric array since database expects numeric[]
      const dailyReturnAmount = amount * selectedPlan.daily_interest;
      
      const { error: invError } = await supabaseClient
        .from('user_investments')
        .insert([{
          user_id: currentUser.id,
          plan_id: selectedPlan.id,
          amount: amount,
          start_date: startDate.toISOString(),
          end_date: endDate.toISOString(),
          status: 'active',
          expected_daily_return: [dailyReturnAmount]
        }]);
        
      if (invError) throw invError;
      
      // Create transaction record
      await supabaseClient
        .from('transactions')
        .insert([{
          user_id: currentUser.id,
          amount: -amount,
          type: 'investment',
          status: 'completed',
          description: `Investment in ${selectedPlan.name}`
        }]);
      
      // Success
      alert(`Successfully invested $${amount.toFixed(2)} in ${selectedPlan.name}!`);
      modal.remove();
      
      // Refresh data
      await fetchUserInvestments();
      updateDashboard();
      
    } catch (error) {
      console.error('Error creating investment:', error);
      showError(errorEl, 'Error creating investment. Please try again.');
    }
  });

  function showError(element, message) {
    element.textContent = message;
    element.classList.remove('hidden');
  }
}



  </script>
</body>
</html>